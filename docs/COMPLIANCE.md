# 合规性设计文档

> 文档版本: v1.0.0  
> 更新日期: 2024-12-29

---

## 1. 合规要求概述

本系统需满足以下法规和标准要求：

| 法规/标准 | 发布机构 | 主要要求 |
|-----------|----------|----------|
| 《中华人民共和国疫苗管理法》 | 全国人大 | 疫苗追溯、冷链管理 |
| 《药品经营质量管理规范》(GSP) | 国家药监局 | 温控记录、质量管理 |
| 《疫苗追溯基本数据集》 | 国家药监局 | 追溯数据标准 |
| 《信息安全等级保护》 | 公安部 | 信息安全 |
| 《医疗器械软件注册技术审查指导原则》 | 国家药监局 | 软件质量 |

---

## 2. 疫苗管理法合规

### 2.1 相关条款

> **第十条** 国家实行疫苗全程电子追溯制度。
> 
> **第三十七条** 疾病预防控制机构、接种单位应当依照规定如实记录疫苗的流通、使用等情况，并按标准提供追溯信息。

### 2.2 合规措施

```
┌─────────────────────────────────────────────────────────────────┐
│                    疫苗追溯合规架构                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    国家疫苗追溯平台                       │   │
│  │                    (协同服务平台)                         │   │
│  └───────────────────────────┬─────────────────────────────┘   │
│                              │                                  │
│                        追溯数据上报                             │
│                              │                                  │
│  ┌───────────────────────────┴─────────────────────────────┐   │
│  │                    本系统追溯模块                         │   │
│  │                                                          │   │
│  │   ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │   │
│  │   │   入库追溯   │  │   出库追溯   │  │   接种追溯   │  │   │
│  │   │              │  │              │  │              │  │   │
│  │   │ • 溯源码采集 │  │ • 出库记录   │  │ • 接种关联   │  │   │
│  │   │ • 批次关联   │  │ • 温度记录   │  │ • 受种者ID   │  │   │
│  │   │ • 供应商信息 │  │ • 操作员ID   │  │ • 时间戳     │  │   │
│  │   └──────────────┘  └──────────────┘  └──────────────┘  │   │
│  │                                                          │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2.3 追溯数据要素

| 数据项 | 说明 | 来源 |
|--------|------|------|
| 疫苗追溯码 | 20位追溯码 | 扫码采集 |
| 疫苗编码 | 疫苗品种编码 | 系统维护 |
| 批号 | 生产批号 | 扫码/录入 |
| 有效期 | 有效期至 | 扫码/录入 |
| 生产企业 | 生产厂家 | 系统维护 |
| 操作时间 | 操作时间戳 | 系统生成 |
| 操作类型 | 入库/出库/接种 | 系统生成 |
| 操作单位 | 接种点编码 | 系统配置 |
| 操作人员 | 操作员ID | 登录信息 |

---

## 3. GSP合规

### 3.1 温控要求

> **GSP第六十五条** 储存药品应当按照药品说明书规定的储存条件进行储存。
> 
> **GSP附录2** 冷藏、冷冻药品储存温度：冷藏2-8℃，冷冻-25至-15℃。

### 3.2 温度监控实现

```
┌─────────────────────────────────────────────────────────────────┐
│                    温度监控合规架构                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │                     温度采集层                           │  │
│   │                                                          │  │
│   │   [PT100] ─── [PT100] ─── [PT100] ─── [PT100]           │  │
│   │      │           │           │           │               │  │
│   │   货道A区     货道B区     货道C区     货道D-F区          │  │
│   │                                                          │  │
│   └─────────────────────────┬───────────────────────────────┘  │
│                             │                                   │
│                        模拟量采集                               │
│                             │                                   │
│   ┌─────────────────────────┴───────────────────────────────┐  │
│   │                     PLC采集层                            │  │
│   │                                                          │  │
│   │   • 采集间隔: ≤30秒 (满足GSP要求)                        │  │
│   │   • 精度: ±0.5℃                                         │  │
│   │   • 校准周期: 每年                                       │  │
│   │                                                          │  │
│   └─────────────────────────┬───────────────────────────────┘  │
│                             │                                   │
│   ┌─────────────────────────┴───────────────────────────────┐  │
│   │                     数据处理层                           │  │
│   │                                                          │  │
│   │   ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │  │
│   │   │  实时监测    │  │  越限报警    │  │  记录存储    │  │  │
│   │   │              │  │              │  │              │  │  │
│   │   │ • 温度显示   │  │ • 声光报警   │  │ • 时序数据库 │  │  │
│   │   │ • 趋势图表   │  │ • 短信通知   │  │ • 保存5年    │  │  │
│   │   │ • 状态指示   │  │ • 邮件通知   │  │ • 防篡改     │  │  │
│   │   └──────────────┘  └──────────────┘  └──────────────┘  │  │
│   │                                                          │  │
│   └──────────────────────────────────────────────────────────┘  │
│                                                                 │
│   ┌──────────────────────────────────────────────────────────┐  │
│   │                     报表生成层                            │  │
│   │                                                          │  │
│   │   • 日温度报表 (符合GSP附录格式)                         │  │
│   │   • 月度温度统计报表                                     │  │
│   │   • 越限事件报表                                         │  │
│   │   • 设备校准记录                                         │  │
│   │                                                          │  │
│   └──────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 3.3 温度报警阈值

| 报警类型 | 条件 | 级别 | 响应 |
|----------|------|------|------|
| 预警高 | T > 7.5℃ | 警告 | 界面提示 |
| 预警低 | T < 2.5℃ | 警告 | 界面提示 |
| 超上限 | T ≥ 8℃ | 紧急 | 声光报警+短信 |
| 超下限 | T ≤ 2℃ | 紧急 | 声光报警+短信 |
| 传感器故障 | 无数据 | 严重 | 报警+停止出库 |

### 3.4 GSP文档要求

| 文档类型 | 内容 | 保存期限 |
|----------|------|----------|
| 温度记录 | 每30秒采集温度 | 5年 |
| 入库验收记录 | 品名、批号、数量、温度 | 5年 |
| 出库记录 | 出库时间、温度、去向 | 5年 |
| 设备验证报告 | 温度分布验证、校准记录 | 长期 |
| 偏差处理记录 | 温度越限事件处理 | 5年 |

---

## 4. 信息安全等保

### 4.1 等保二级要求

| 安全域 | 要求 | 实现措施 |
|--------|------|----------|
| 物理安全 | 机房安全 | 门禁、监控、消防 |
| 网络安全 | 边界防护 | 防火墙、VLAN隔离 |
| 主机安全 | 系统加固 | 补丁更新、安全配置 |
| 应用安全 | 身份认证 | JWT+验证码 |
| 数据安全 | 数据保护 | 加密存储、备份 |
| 管理安全 | 安全管理 | 制度、培训 |

### 4.2 安全实现

```
┌─────────────────────────────────────────────────────────────────┐
│                    安全防护体系                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌────────────────────────────────────────────────────────────┐│
│  │                       网络边界                              ││
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   ││
│  │  │ 防火墙   │  │   VPN    │  │ 入侵检测 │  │ DDoS防护 │   ││
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘   ││
│  └────────────────────────────────────────────────────────────┘│
│                               │                                 │
│  ┌────────────────────────────┼───────────────────────────────┐│
│  │                       应用层安全                            ││
│  │                            │                                ││
│  │   ┌──────────────────────────────────────────────────────┐ ││
│  │   │                    API网关                            │ ││
│  │   │  • JWT认证    • 权限控制   • 限流熔断   • 审计日志   │ ││
│  │   └──────────────────────────────────────────────────────┘ ││
│  │                                                             ││
│  │   ┌──────────┐  ┌──────────┐  ┌──────────┐               ││
│  │   │ 输入验证 │  │ SQL防注入│  │ XSS防护  │               ││
│  │   └──────────┘  └──────────┘  └──────────┘               ││
│  └─────────────────────────────────────────────────────────────┘│
│                               │                                 │
│  ┌────────────────────────────┼───────────────────────────────┐│
│  │                       数据层安全                            ││
│  │                            │                                ││
│  │   ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ ││
│  │   │传输加密  │  │存储加密  │  │访问控制  │  │备份加密  │ ││
│  │   │ TLS 1.3  │  │ AES-256  │  │ 最小权限 │  │ 异地备份 │ ││
│  │   └──────────┘  └──────────┘  └──────────┘  └──────────┘ ││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 4.3 权限控制矩阵

| 角色 | 疫苗管理 | 库存操作 | 订单处理 | 设备控制 | 系统配置 | 审计查看 |
|------|----------|----------|----------|----------|----------|----------|
| 超级管理员 | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| 管理员 | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| 操作员 | 查看 | ✓ | ✓ | 有限 | - | - |
| 查看员 | 查看 | 查看 | 查看 | 查看 | - | - |

### 4.4 审计日志要求

```sql
-- 审计日志必须记录的内容
{
    "log_id": "uuid",
    "timestamp": "ISO8601时间戳",
    "user_id": "用户ID",
    "username": "用户名",
    "ip_address": "客户端IP",
    "action": "操作类型",
    "resource": "资源类型",
    "resource_id": "资源ID",
    "old_value": "修改前值(敏感操作)",
    "new_value": "修改后值(敏感操作)",
    "result": "操作结果",
    "duration_ms": "耗时"
}
```

审计日志保存要求：
- 保存期限: ≥180天（等保二级）
- 防篡改: 只允许追加，不允许修改删除
- 备份: 定期备份至异地

---

## 5. 医疗器械软件合规

### 5.1 软件安全性分类

根据《医疗器械软件注册技术审查指导原则》，本软件属于：

| 分类项 | 评估 |
|--------|------|
| 软件安全性级别 | B级（中等风险） |
| 独立软件 | 是 |
| 软件组件 | 包含 |
| 网络安全能力 | 2级 |

### 5.2 软件生命周期管理

```
┌─────────────────────────────────────────────────────────────────┐
│                    软件生命周期管理                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌───────────┐    ┌───────────┐    ┌───────────┐             │
│   │  需求阶段  │───►│  设计阶段  │───►│  实现阶段  │             │
│   │           │    │           │    │           │             │
│   │ • 需求规格 │    │ • 架构设计 │    │ • 编码实现 │             │
│   │ • 风险分析 │    │ • 详细设计 │    │ • 单元测试 │             │
│   │ • 追溯矩阵 │    │ • 接口设计 │    │ • 代码审查 │             │
│   └───────────┘    └───────────┘    └─────┬─────┘             │
│                                            │                   │
│   ┌───────────┐    ┌───────────┐    ┌─────┴─────┐             │
│   │  维护阶段  │◄───│  发布阶段  │◄───│  验证阶段  │             │
│   │           │    │           │    │           │             │
│   │ • 问题跟踪 │    │ • 发布管理 │    │ • 集成测试 │             │
│   │ • 变更管理 │    │ • 版本控制 │    │ • 系统测试 │             │
│   │ • 持续改进 │    │ • 发布审核 │    │ • 验收测试 │             │
│   └───────────┘    └───────────┘    └───────────┘             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 5.3 需求追溯矩阵

| 需求ID | 需求描述 | 设计文档 | 代码模块 | 测试用例 |
|--------|----------|----------|----------|----------|
| REQ-001 | 疫苗入库 | ARCH-3.2 | InventoryService | TC-001~005 |
| REQ-002 | 智能分拣 | ARCH-3.3 | SortingService | TC-010~020 |
| REQ-003 | 温度监控 | ARCH-3.4 | TemperatureService | TC-030~040 |
| REQ-004 | 追溯查询 | ARCH-3.5 | TraceService | TC-050~060 |

### 5.4 风险分析

| 危害 | 风险场景 | 严重度 | 发生概率 | 风险等级 | 控制措施 |
|------|----------|--------|----------|----------|----------|
| 温度失控 | 制冷故障未发现 | 严重 | 低 | 中 | 多点监测+报警 |
| 分拣错误 | 取错疫苗 | 严重 | 极低 | 低 | 双重验证 |
| 数据丢失 | 系统故障 | 一般 | 低 | 低 | 冗余备份 |
| 追溯断链 | 扫码失败 | 一般 | 低 | 低 | 人工补录 |

---

## 6. 合规检查清单

### 6.1 疫苗法合规检查

- [ ] 实现疫苗全程电子追溯
- [ ] 每支疫苗具有唯一溯源码
- [ ] 追溯数据可上报国家平台
- [ ] 追溯信息包含完整要素
- [ ] 追溯记录保存期限合规

### 6.2 GSP合规检查

- [ ] 温度采集间隔≤30秒
- [ ] 温度记录保存≥5年
- [ ] 温度越限自动报警
- [ ] 入库验收记录完整
- [ ] 出库记录完整
- [ ] 设备定期校准验证
- [ ] 偏差记录和处理

### 6.3 等保合规检查

- [ ] 用户身份认证
- [ ] 访问权限控制
- [ ] 数据传输加密
- [ ] 数据存储加密
- [ ] 操作审计日志
- [ ] 安全事件响应
- [ ] 数据备份恢复

### 6.4 软件质量检查

- [ ] 需求追溯完整
- [ ] 设计文档齐全
- [ ] 代码审查记录
- [ ] 测试用例覆盖
- [ ] 缺陷跟踪记录
- [ ] 版本管理规范
- [ ] 发布审核流程

---

## 7. 合规文档清单

| 文档名称 | 用途 | 责任人 |
|----------|------|--------|
| 疫苗追溯方案 | 满足疫苗法 | 产品经理 |
| 温控验证报告 | GSP验证 | 质量部 |
| 设备校准记录 | GSP要求 | 运维 |
| 安全设计方案 | 等保评测 | 架构师 |
| 风险分析报告 | 医疗器械注册 | 产品经理 |
| 软件描述文档 | 医疗器械注册 | 技术负责人 |
| 测试报告 | 验收/注册 | 测试经理 |
| 用户手册 | 用户使用 | 技术文档 |

---

> 文档审批：
> - 质量负责人: __________ 日期: __________
> - 法规事务: __________ 日期: __________

